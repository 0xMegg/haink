"use strict";(()=>{var t={};t.id=898,t.ids=[898],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5610:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>d,PUT:()=>c});var o=r(3036),n=r(5736),i=r(5262),s=r(942),l=r(5500),p=r(3513),u=r(3351);async function d(t,{params:e}){let r=await l._.product.findUnique({where:{id:e.id},include:{externalProductMaps:!0,optionValues:!0}});return r?s.NextResponse.json({data:r}):s.NextResponse.json({error:"상품을 찾을 수 없습니다."},{status:404})}async function c(t,{params:e}){try{let r=await t.json(),a=p.kx.parse(r),o=(0,u.i)(a.categoryIdsRaw),n=(a.optionValues??"").split(",").map(t=>t.trim()).filter(Boolean),i=a.saleStatus?.trim()?a.saleStatus:null,d=a.descriptionHtml?.trim()?a.descriptionHtml:null,c=a.optionName?.trim()?a.optionName:null,m=a.currentCategoryId??o[0],_=a.sotMode??"LEGACY_IMWEB",h=a.sourceOfTruth??"IMWEB",w=a.externalUrl?.trim()?a.externalUrl.trim():null,y=function(t){if(!t)return null;try{return JSON.parse(t)}catch{throw Error("rawSnapshot 필드는 올바른 JSON 문자열이어야 합니다.")}}(a.rawSnapshot),x=await l._.$transaction(async t=>{await t.productOptionValue.deleteMany({where:{product_id:e.id}});let r=await t.externalProductMap.findFirst({where:{product_id:e.id,system:"IMWEB"}});await t.product.update({where:{id:e.id},data:{name:a.name,current_category_id:m,category_ids_raw:o,price_sale:a.priceSale,inventory_track:a.inventoryTrack,stock_qty:a.inventoryTrack?a.stockQty??null:null,sale_status:i,display_status:a.displayStatus,description_html:d,option_name:c,sot_mode:_,optionValues:n.length>0&&c?{createMany:{data:n.map(t=>({option_name:c,display_value:t,canonical_value:t.toUpperCase()}))}}:void 0}}),r&&await t.externalProductMap.update({where:{id:r.id},data:{external_url:w,source_of_truth:h,raw_snapshot:y??void 0}});let s=await t.product.findUnique({where:{id:e.id},include:{externalProductMaps:!0,optionValues:!0}});if(!s)throw Error("업데이트된 상품을 찾을 수 없습니다.");return s});return s.NextResponse.json({data:x})}catch(e){let t=e instanceof Error?e.message:"알 수 없는 오류";return s.NextResponse.json({error:t},{status:400})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"/Users/mero/Documents/New project/apps/admin/app/api/products/[id]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:_,staticGenerationAsyncStorage:h,serverHooks:w}=m,y="/api/products/[id]/route";function x(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},3351:(t,e,r)=>{r.d(e,{i:()=>a});function a(t){let e=t.split(",").map(t=>t.trim()).filter(Boolean),r=[],a=new Set;for(let t of e)a.has(t)||(a.add(t),r.push(t));if(0===r.length)throw Error("카테고리 ID는 최소 1개 이상이어야 합니다.");return r}},5500:(t,e,r)=>{r.d(e,{_:()=>o});let a=require("@prisma/client"),o=globalThis.prisma??new a.PrismaClient},3513:(t,e,r)=>{r.d(e,{kx:()=>i});var a=r(9763);let o=a.Km(["LEGACY_IMWEB","MASTER"]),n=a.Km(["IMWEB","MASTER"]),i=a.Ry({productId:a.Z_().min(1,"IMWEB 상품번호를 입력하세요."),name:a.Z_().min(1,"상품명을 입력하세요."),categoryIdsRaw:a.Z_().min(1,"카테고리 ID를 입력하세요."),priceSale:a.oQ.number().int().nonnegative("가격은 0 이상이어야 합니다."),inventoryTrack:a.O7(),stockQty:a.oQ.number().int().nonnegative().nullable().optional(),descriptionHtml:a.Z_().optional(),saleStatus:a.Z_().optional(),displayStatus:a.O7(),optionName:a.Z_().optional().nullable(),optionValues:a.Z_().optional(),issuedCategoryId:a.Z_().optional(),currentCategoryId:a.Z_().optional(),sotMode:o.optional(),externalUrl:a.Z_().url("올바른 URL 형식이 아닙니다.").or(a.i0("")).optional(),sourceOfTruth:n.optional(),rawSnapshot:a.Z_().optional()})}};var e=require("../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[193,11],()=>r(5610));module.exports=a})();